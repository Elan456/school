from pathing import *
from quadtree import *
from egene import pygameTools as pgt
from egene import pygameTools as yseful
import math
import copy

cenpath = [(1620.3919189857868, 2341.941125496951), (1620.3919189857868, 2341.941125496951), (1620.3919189857868, 2341.941125496951), (1620.3919189857868, 2326.5856822969504), (1620.3919189857868, 2289.5808375267607), (1620.3919189857868, 2249.9024398707234), (1620.3919189857868, 2209.9369716594642), (1620.3919189857868, 2169.9406794820475), (1620.3919189857868, 2129.9410776064656), (1620.3919189857868, 2089.9411203547493), (1620.957604410736, 2050.1754395198614), (1646.6352697675325, 2031.7565187506386), (1685.0659716252587, 2029.7028771798539), (1724.8974695202903, 2029.4823690952483), (1764.8793767445368, 2029.4586922199512), (1804.8774340475331, 2029.4561499348242), (1831.7570452166256, 2015.026309994443), (1831.089651692091, 1984.7943510777277), (1798.7804941284548, 1979.289586502695), (1759.606292047026, 1978.6985169071468), (1719.6949614233602, 1978.6350512925835), (1679.704482225148, 1978.6282367241095), (1639.7055045134557, 1978.627505015391),
               (1599.705614280827, 1978.627426448766), (1559.7056260670086, 1978.6274180127389), (1519.7056273325402, 1978.6274171069274), (1479.7056274684257, 1978.6274170096665), (1457.8242966180671, 1963.506288374274), (1443.8457028777689, 1931.299059579667), (1441.808542403026, 1892.3579117788993), (1445.2100763995086, 1855.2833327311978), (1477.3387614283592, 1846.6904895058544), (1516.493585418919, 1845.7678399900417), (1556.4028353359215, 1845.66877125264), (1596.3930911199568, 1845.6581338279605), (1636.3920448427343, 1845.6569916431824), (1676.3919324995732, 1845.6568690020256), (1716.3919204368178, 1845.6568558335318), (1756.3919191415894, 1845.6568544195754), (1796.3919190025151, 1845.656854267753), (1831.8944138024272, 1834.7989162366066), (1854.5202425786972, 1805.925362686793), (1857.9236479956403, 1767.52348966003), (1858.2890858696605, 1727.6950872371528), (1858.3283244626016, 1687.7135123866983), (1858.3325376744372, 1647.7154907720662),
               (1858.3329900646136, 1607.7157031995773), (1858.333038639639, 1567.715726008808), (1858.3330438553426, 1527.7157284579305), (1858.3330444153744, 1487.715728720903), (1858.3330444755074, 1447.7157287491395), (1858.3330444819642, 1407.7157287521716), (1847.4751064678126, 1372.2132339376524), (1818.601552919824, 1349.5874051598137), (1780.1996798932573, 1346.1839997427019), (1740.3712774704013, 1345.8185618686637), (1700.3897026199488, 1345.7793232757203), (1660.391681005317, 1345.7751100638848), (1620.391893432828, 1345.7746576737084), (1580.3919162420586, 1345.774609098683), (1540.3919186911812, 1345.7746038829794), (1500.3919189541537, 1345.7746033229475), (1461.0479997925324, 1344.1906840729566), (1436.6222446129284, 1319.6625372560884), (1433.0255735700468, 1281.727248724471), (1432.639383957456, 1241.9489454302802), (1432.5979171635527, 1201.9727499328073), (1432.5934647004606, 1161.9753059218035), (1432.5929866208764, 1121.9755803690323),
               (1432.592935287472, 1081.9756098375792), (1432.59292977559, 1041.97561300174), (1432.5929291837563, 1001.9756133414893), (1432.5929291202083, 961.9756133779696), (1432.592929113385, 921.9756133818868), (1432.5929291126522, 881.9756133823074), (1432.5929291125735, 841.9756133823525), (1432.5929291125653, 801.9756133823576), (1432.5929291125647, 761.975613382358), (1432.5929291125647, 721.975613382358), (1432.5929291125647, 681.975613382358), (1432.5929291125647, 641.975613382358), (1432.5929291125647, 601.975613382358), (1432.5929291125647, 561.975613382358), (1432.5929291125647, 521.975613382358), (1432.5929291125647, 481.975613382358), (1432.5929291125647, 441.975613382358), (1432.5929291125647, 401.975613382358), (1432.5929291125647, 361.975613382358), (1432.5929291125647, 321.975613382358), (1432.5929291125647, 281.975613382358), (1432.5929291125647, 241.975613382358), (1432.5929291125647, 201.975613382358), (1432.5929291125647, 161.975613382358),
               (1432.0272436876155, 122.20992795740877), (1405.3352513050677, 106.23980875758132), (1366.7641877423646, 104.52503026566932), (1326.917618624021, 104.34090732710314), (1286.9340931394936, 104.32113727711352), (1246.935862077123, 104.31901448415988), (1206.9360520153546, 104.31878655100208), (1166.936072409817, 104.31876207686564), (1126.936074599656, 104.31875944897527), (1086.9360748347883, 104.31875916680767), (1046.9360748600352, 104.31875913651017), (1006.9360748627461, 104.318759133257), (966.9360748630371, 104.31875913290769), (926.9360748630683, 104.3187591328702), (886.9360748630716, 104.31875913286618), (846.9360748630718, 104.31875913286576), (806.9360748630718, 104.31875913286574), (766.9360748630718, 104.31875913286574), (726.9360748630718, 104.31875913286574), (686.9360748630718, 104.31875913286574), (646.9360748630718, 104.31875913286574), (606.9360748630718, 104.31875913286574), (566.9360748630718, 104.31875913286574),
               (526.9360748630718, 104.31875913286574), (486.9360748630718, 104.31875913286574), (472.6540617814718, 126.46624278086571), (471.12054230380886, 164.54934343378704), (470.95588190370034, 204.34351793365136), (470.93820162786506, 244.3214175888572), (470.93630322270263, 284.3190445824042), (470.9360993830005, 324.31878978277655), (470.9360774958792, 364.3187624238749), (470.93607514576746, 404.3187594862352), (470.93607489342617, 444.31875917080856), (470.9360748663313, 484.31875913693995), (470.93607486342205, 524.3187591333035), (470.93607486310975, 564.318759132913), (470.93607486307616, 604.318759132871), (470.9360748630726, 644.3187591328665), (470.93607486307224, 684.3187591328661), (470.93607486307224, 724.3187591328661), (470.93607486307224, 764.3187591328661), (470.93607486307224, 804.3187591328661), (470.93607486307224, 844.3187591328661), (470.93607486307224, 884.3187591328661), (470.93607486307224, 924.3187591328661), (470.93607486307224, 964.3187591328661),
               (470.93607486307224, 1004.3187591328661), (470.93607486307224, 1044.318759132866), (470.93607486307224, 1084.318759132866), (470.93607486307224, 1124.318759132866), (470.93607486307224, 1164.318759132866), (467.7375686612874, 1202.5252653346508), (436.254693536457, 1212.7461416225406), (397.16921285632714, 1213.843599857364), (357.2674086205873, 1213.9614385380464), (317.2779523104898, 1213.9740913700393), (277.2790844305726, 1213.9754499575297), (237.2792059910408, 1213.9755958347507), (197.27921904349668, 1213.9756114981983), (157.5135350200442, 1214.5412986049976), (144.06814304544994, 1242.2790673637837), (142.62445507513036, 1280.9624203098588), (147.10353526086075, 1318.9015414101182), (177.72149685426638, 1333.2233965957917), (216.7141081511129, 1334.7611940868046), (256.6059406127527, 1334.926313835099), (296.5943262117591, 1334.9440434330702), (336.5930791249484, 1334.9459471341568), (376.5929452200217, 1334.9461515425046),
               (416.59293084208963, 1334.946173490684), (452.09542411311577, 1345.8041138621963), (463.071592902449, 1379.5031147589307), (464.2501500520881, 1418.8265501319145), (464.37669666244227, 1458.7539045582475), (464.3902845012645, 1498.74610429917), (464.3917434843486, 1538.745266752729), (464.39190014146436, 1578.7451768218648), (441.7090488287715, 1600.3546051808348), (403.67067331274717, 1602.921656173634), (363.8813011378899, 1603.1972911751648), (323.9039171284052, 1603.226887258095), (283.90634550189606, 1603.2300651133019), (243.90660624651414, 1603.2304063329066), (203.90663424375435, 1603.2304429710828), (163.9066372499351, 1603.230446905077), (123.90663757272134, 1603.2304473274867), (83.90663760738023, 1603.2304473728423), (69.62462452950172, 1603.2304473777122), (68.0911050522384, 1603.2304473782349), (54.40276173377277, 1603.2304473782908), (52.17465689834202, 1609.784047378297), (51.93541596333616, 1643.934134820074), (51.90972766354329, 1683.3060052420233),
               (51.90696940335578, 1723.2385603421392), (51.90667323742331, 1763.2313185011567), (51.90664143684847, 1803.2305409144024), (51.906638022287744, 1843.2304574216603), (51.90663765565208, 1883.2304484566955), (51.906637616284875, 1916.6768474940898), (51.90663761205786, 1922.526759948954), (51.90663761160398, 1922.3548895159065), (51.90663761155524, 1903.0908248798792), (74.05412125955002, 1899.644952256285), (112.1372219124708, 1899.2749545006723), (151.9313964123351, 1899.2352262941733), (191.90929606754094, 1899.2309605104822), (231.90692306108792, 1899.2305024754457), (267.0812211658343, 1910.880113117082), (306.15963148769424, 1913.104956085975), (346.0606765494956, 1913.3438467807284), (373.85574734391207, 1913.3694974737607), (377.59855050841264, 1913.3722516959526), (382.1924309380851, 1913.3725474283087), (414.9231918228645, 1913.3725791823283), (454.14266321619755, 1913.37258259189), (481.86455059521694, 1913.3725829579887),
               (485.59949575032414, 1912.5725829972982), (486.0005324326626, 1883.9981934667994), (486.04359341854115, 1845.2250090493826), (486.04821705669326, 1805.3567373695182), (486.04871351605954, 1765.3708815901916), (486.04876682297817, 1725.3724003143225), (486.0487725467649, 1685.3725633860843), (486.0487731613519, 1645.3725808957813), (490.2407732273427, 1620.7280259758709), (522.1283825366493, 1617.732870947934), (532.7688310301268, 1617.4112686256483), (540.4649404874833, 1617.3767368392346), (574.737703948128, 1617.3730290169015), (614.1227466073035, 1617.37263089251), (628.3387291472217, 1617.3725881442288), (636.418758649458, 1617.3725835541668), (670.7327452110286, 1617.3725830613128), (710.1222141669617, 1617.3725830083931), (750.0566588952752, 1617.372583002711), (790.0496199515758, 1617.3725830021008), (823.4952641507512, 1617.372583002035), (829.3450955554788, 1617.372583002028), (829.9732164197393, 1608.1297030020276), (825.8486603839876, 1582.052513048606),
               (793.1682928222858, 1577.8750866644682), (753.9542323708167, 1577.4265389219352), (714.0386219872562, 1577.3783764748134), (674.0476832533244, 1577.3732050714314), (634.0486561993599, 1578.5726497962212), (594.0487606686448, 1588.2129490040795), (554.0487718859489, 1589.2480682496152), (514.8487730903976, 1589.3592133322911), (503.4231627544443, 1582.8175474446714), (502.19634718620034, 1548.668741418454), (502.0646188676045, 1509.2970085874526), (502.0504746470964, 1469.3644682610527), (502.0489559229836, 1429.3717116883506), (502.04879285122377, 1389.3724894454342), (502.04877534152683, 1349.3725729564649), (502.8487734614374, 1331.5200655713936), (531.4231627942844, 1329.6031671871317), (570.1963471904783, 1329.3973417903778), (610.064618868064, 1329.3752414566843), (650.0504746471457, 1329.3728684514233), (690.048955922989, 1329.3726136519235), (730.0487928512242, 1329.3725862930353), (770.0487753415267, 1329.372583355397), (810.0487734614372, 1329.3725830399708),
               (850.048773259564, 1329.3725830061023), (890.0487732378879, 1329.3725830024657), (930.0487732355602, 1329.3725830020749), (953.7183144719353, 1311.663244005408), (956.5380175704978, 1274.2348203204729), (956.8407808853166, 1234.5109412247823), (956.8732898487059, 1194.5405894811265), (956.8767804720704, 1154.5437729384112), (956.8771552749002, 1114.5441147595345), (956.8771955190475, 1081.0977514622982), (982.5951867586298, 1075.247842845004), (1021.0616677449502, 1074.6197136901076), (1060.8970073946614, 1074.5522688356589), (1100.8793271241755, 1074.5450269995551), (1140.8774287195872, 1074.5442494133247), (1180.8772248799464, 1074.544165920639), (1220.8772029928314, 1074.5441569556806), (1260.87720064272, 1074.5441559930753), (1298.6372003903787, 1074.5441558897164), (1307.7776887355078, 1074.5441558786185), (1308.7591411983028, 1055.859801317427), (1319.8910647265948, 1022.8232682766125), (1333.2338889527928, 984.2325030508164),
               (1329.8342580285878, 944.3838184825061), (1329.1068375720397, 904.4000658532684), (1329.0287313952565, 864.4018104014202), (1329.0203448083842, 824.4019977208518), (1329.0194443054756, 786.6420178341225), (1329.0193476147124, 777.5015316215446), (1329.0193372326205, 776.5200793877304), (1306.871852469852, 776.41469675656), (1268.788751697233, 776.403381382699), (1228.9945771845162, 776.4021664036821), (1189.01667752793, 776.4020359463036), (1149.0190505342348, 776.4020219385493), (1109.0193053338467, 776.4020204344782), (1069.0193326927467, 776.4020202729797), (1029.0193356303864, 776.4020202556388), (989.019335945813, 776.4020202537766), (949.019335979682, 776.4020202535768), (909.0193359833187, 776.4020202535553), (871.7265128580158, 769.8663171278595), (842.0715218354317, 744.8912561518117), (813.6400706728166, 716.9623086516325), (785.3399961022994, 688.7161900010225), (754.3468511116388, 666.9717184831475), (715.7173886868932, 663.6629480812268),
               (682.4181490384846, 663.3076715645711), (676.5840377026949, 663.2695240390692), (669.9757323311078, 652.4436809828318), (636.2938195773119, 648.866775046805), (596.9722190297049, 648.4827076964024), (557.0450616162464, 648.4414687786663), (517.0528830294201, 648.4370407835913), (495.73807740726494, 648.4365653312404), (493.34204339817103, 648.436514279933), (493.0847712054419, 648.4365087983405), (493.0571468140933, 657.6793882097588), (493.05418066765804, 692.9994580999818), (493.05386218010966, 732.4969544307553), (493.05382798276963, 772.442998510119), (493.0538243108582, 812.4372050372549), (493.0538239165897, 852.4365829678429), (493.05382387425544, 892.4365161736484), (493.0538238697098, 932.4365090016762), (493.0538238692218, 972.4365082315916), (493.0538238691693, 1012.4365081489042), (493.0538238691637, 1052.4365081400258), (493.0538238691631, 1092.4365081390724), (493.0538238691631, 1132.4365081389699), (493.0538238691631, 1172.4365081389587),
               (493.0538238691631, 1212.4365081389578), (493.0538238691631, 1252.4365081389578), (493.0538238691631, 1292.4365081389578), (493.0538238691631, 1332.4365081389578), (511.4216366171886, 1359.4139572389831), (548.6954643148529, 1363.284614330305), (588.4027437928081, 1363.700222970836), (628.3713131660818, 1363.7448486088113), (668.3679383282348, 1363.7496402502027), (708.3675759577803, 1363.7501547487798), (748.3675370485491, 1363.750209992644), (788.3675328707022, 1363.7502159244084), (828.3675324221093, 1363.7502165613273), (868.367532373942, 1363.7502166297154), (908.3675323687701, 1363.7502166370587), (948.3675323682147, 1363.7502166378472), (988.3675323681549, 1363.7502166379315), (1028.3675323681484, 1363.7502166379409), (1068.367532368148, 1363.7502166379415), (1108.367532368148, 1363.7502166379415), (1148.367532368148, 1363.7502166379415), (1188.367532368148, 1363.7502166379415), (1228.367532368148, 1363.7502166379415), (1268.367532368148, 1363.7502166379415),
               (1308.367532368148, 1363.7502166379415), (1348.367532368148, 1363.7502166379415), (1388.367532368148, 1363.7502166379415), (1428.367532368148, 1363.7502166379415), (1468.367532368148, 1363.7502166379415), (1508.367532368148, 1363.7502166379415), (1548.367532368148, 1363.7502166379415), (1588.367532368148, 1363.7502166379415), (1628.367532368148, 1363.7502166379415), (1668.367532368148, 1363.7502166379415), (1708.367532368148, 1363.7502166379415), (1748.367532368148, 1363.7502166379415), (1788.367532368148, 1363.7502166379415), (1815.3449814681733, 1382.118029385967), (1819.2156385594951, 1419.3918570836315), (1819.631247200026, 1459.0991365615864), (1819.6758728380014, 1499.06770593486), (1798.7881246566192, 1524.9960040013868), (1761.2437209520972, 1528.7540093582725), (1721.507388596629, 1529.1575221109226), (1681.535699694386, 1529.2008489628265), (1641.5387395753605, 1529.2055011481257), (1601.5390659800948, 1529.2060006727183),
               (1561.5391010275362, 1529.2060543087632), (1521.5391047907265, 1529.2060600678894), (1481.5391051947959, 1529.2060606862706), (1441.5391052381826, 1529.2060607526687), (1401.539105242841, 1529.206060759798), (1361.539105243341, 1529.2060607605633), (1321.5391052433947, 1529.2060607606456), (1281.5391052434006, 1529.2060607606545), (1241.5391052434009, 1529.2060607606552), (1201.5391052434009, 1529.2060607606552), (1161.5391052434009, 1529.2060607606552), (1121.5391052434009, 1529.2060607606552), (1081.5391052434009, 1529.2060607606552), (1042.7608714784922, 1531.0242945255638), (1032.0045577784292, 1561.2145093881227), (1030.849607389247, 1600.1611917294701), (1030.7255955354958, 1640.0480926070647), (1030.7122798640912, 1680.035948681266), (1030.7108501047612, 1720.0346447371621), (1030.710696585522, 1760.03450472723), (1030.710680101519, 1799.234489693778), (1056.4286652499627, 1810.6600985448533), (1094.8951455822519, 1811.88691395366),
               (1134.7304851617373, 1812.0186422551367), (1174.7128048837108, 1812.0327864738063), (1214.7109064783128, 1812.0343051977216), (1254.7107026385856, 1812.0344682694601), (1294.7106807514617, 1812.0344857791547), (1334.7106784013497, 1812.0344876592442), (1374.7106781490083, 1812.034487861117), (1414.7106781219136, 1812.0344878827927), (1442.5163741190045, 1821.2773678851202), (1446.260318155955, 1856.5974378387912), (1446.6623210858743, 1896.0949341763774), (1446.7054858217966, 1936.0409782564727), (1446.7101206000248, 1976.035184783687), (1446.7106182555476, 1997.3502081542836), (1446.7106716909025, 1999.7462655439383), (1446.71067742848, 2000.003540247136), (1446.7106780445476, 2000.031164908044), (1446.7106781106972, 2000.0341310834233), (1424.5631944698002, 2000.0344495740792), (1386.4800938176415, 2000.0344837717528), (1346.6859193178595, 2000.0344874437), (1306.7080196626625, 2000.0344878379724), (1266.7103926691168, 2000.0344878803069),
               (1226.9449620437956, 2000.6001733098017), (1206.1721723439957, 2025.3028231037115), (1203.6949547431893, 2063.5580728302693), (1203.4289655286761, 2103.3707316961663), (1203.4004051542406, 2143.350616095062), (1203.3973385073864, 2176.7948561988405), (1203.3970092286877, 2182.6445368399727), (1203.3969738726569, 2183.272641516115), (1203.3969700763316, 2183.3400837421773), (1203.3969696687043, 2198.702768496061), (1203.396969624936, 2235.708390822178), (1203.3969696202362, 2275.386871967649), (1203.3969696197316, 2315.3523491435176), (1203.3969696196777, 2355.3486422835017), (1203.3969696196716, 2395.3482442624386), (1203.3969696196714, 2435.3482015252525), (1213.644611804407, 2471.103484561117), (1217.120937194528, 2509.6635429445805), (1217.4942047910486, 2549.5089303908017), (1224.069987219735, 2586.785152119945), (1249.0493516781723, 2616.4383605811895), (1274.0145696345205, 2646.0974287160047), (1279.1471077025276, 2683.971461838833),
               (1279.698209781217, 2723.7431878835873), (1279.7573839163354, 2763.71867715428), (1279.763737690713, 2803.716045334761), (1279.764419922042, 2843.7157627452916), (1279.7644931760733, 2883.715732402478), (1279.7645010416647, 2923.7157291444432), (1279.7645018862263, 2963.7157287946147), (1279.7645019769107, 3003.7157287570517), (1279.7645019866477, 3043.7157287530185), (1279.1988165627438, 3083.4814141775346), (1258.9936719545897, 3115.112169251034), (1229.6573853257137, 3139.1216714620473), (1191.4639310330776, 3143.2967666329946), (1151.6579074013741, 3143.745064063417), (1111.678735455325, 3143.7931996334805), (1071.680971850589, 3143.7983681509604), (1034.3883888560085, 3137.263219990606), (1006.3173428071221, 3111.632137793366), (999.7068643491313, 3074.664654999831), (998.9970696294317, 3034.990269055489), (998.920856001732, 2995.0252315984935), (998.9126726257701, 2955.0289856729632), (1014.0431327527527, 2925.1360045133542),
               (1049.97924221679, 2926.8750126605914), (1080.5747897420347, 2949.0750230122944), (1109.1072323901242, 2976.706001720566), (1137.4181508388235, 3004.9201262157644), (1165.7052833077316, 3033.1968655130536), (1197.561490726257, 3052.857652973274), (1236.464947893763, 3055.5049343529327), (1276.3472075036575, 3055.789184026656), (1316.3345652255343, 3055.8197051029692), (1356.333207771257, 3055.8229822785843), (1396.333062015714, 3055.823334162637), (1436.3330463653317, 3055.823371945899), (1476.333044684885, 3055.823376002846), (1516.3330445044485, 3055.8233764384577), (1556.3330444850742, 3055.823376485231), (1596.3330444829937, 3055.8233764902543), (1627.0901644827707, 3055.8233764907945), (1631.7700945293254, 3030.1053895724526), (1627.6385031905788, 2993.558414048938), (1606.5088923290264, 2962.4975951093643), (1601.7881994368306, 2924.4730501399467), (1601.2813188971695, 2884.685163008724), (1601.2268930136488, 2844.7079384545846),
               (1601.2210490789043, 2804.710383949463), (1601.220421591189, 2764.7106465324764), (1601.7860396401582, 2724.944989302164), (1615.45547388829, 2690.607060381687), (1617.8971937655226, 2651.618454517172), (1618.15937144099, 2611.7270521355545), (1618.1875225545368, 2571.7387127160387), (1618.1905452573376, 2531.7399647613347), (1618.1908698175794, 2491.7400991986747), (1618.19090466697, 2451.740113633774), (1618.1909084088948, 2411.740115183731), (1618.1909088106809, 2371.740115350157), (1618.1909088538218, 2331.7401153680266), (1618.1909088584543, 2291.740115369945)]
cenpath = SimplePath([Point(cenpath[n][0], cenpath[n][1]) for n in range(len(cenpath))])
noescapepath = [(157.01589160609961, 1200.834344310411), (196.9483799403063, 1200.8343443104068), (236.94113093038928, 1200.8343443104068), (276.9403525738762, 1200.8343443104068), (316.94026899848205, 1200.8343443104068), (356.9402600246425, 1200.8343443104068), (396.9402590610838, 1200.8343443104068), (436.9402589576226, 1200.8343443104068), (476.94025894651344, 1200.8343443104068), (516.9402589453206, 1200.8343443104068), (556.9402589451926, 1200.8343443104068), (595.7124505719129, 1203.7985359371407), (626.1384714680673, 1226.9121661355175), (653.0687921431052, 1255.2973248379922), (650.9341110964859, 1288.9888953947939), (625.9938511177116, 1318.0758807470113), (598.0686403461615, 1346.446342765172), (569.8229229237328, 1374.7398686761678), (541.5427913617123, 1403.0251336355602), (513.2589646095901, 1431.3095115820283), (484.97474108945187, 1459.5937942862088), (456.69047496667235, 1487.8780667638262), (439.26414228431395, 1520.6598433285305),
                    (437.1462477696923, 1559.7825826866085), (414.2359724441527, 1581.2978255576527), (376.17317746069097, 1583.8547634606916), (336.6154978405337, 1584.694998002427), (304.3509964100692, 1603.345702907779), (266.6712556498503, 1608.944679937554), (226.92039158867794, 1609.5458655184023), (188.84803415519644, 1614.1995760898367), (152.81730274200797, 1623.7822348960985), (123.47915190533405, 1649.5222153973477), (95.08172119863245, 1677.5332955061474), (66.78529954675385, 1705.7882330784564), (45.0354267852454, 1736.7765315208383), (45.26847642920553, 1775.4054735514253), (51.74094985096852, 1813.3387523241208), (76.0861026390138, 1843.320616068368), (103.9474142625191, 1871.7871649222207), (132.18627056617046, 1900.0910080786384), (160.46566542117193, 1928.3773808438227), (196.28203703991275, 1938.4765147915643), (235.83282336300962, 1939.560901042151), (275.7845894117293, 1939.6773361292137), (315.7794103306466, 1939.6898382514898),
                    (355.77885423104976, 1939.6911806566477), (395.7787945203102, 1939.691324796304), (430.30626736038806, 1926.479506461712), (459.2923464443161, 1899.889552535031), (487.6519737344205, 1871.7872072246141), (497.7589733268824, 1835.9898461559674), (498.8442041446401, 1796.4411010751437), (498.9607299164121, 1756.4895542031445), (498.9732417758848, 1716.494756818148), (517.1599481750336, 1684.0279394146128), (544.3600016526769, 1655.2945706932924), (572.5278559035611, 1626.962077971757), (602.027435344464, 1601.636820609676), (639.8843434991815, 1596.4656236048468), (679.6542307644864, 1595.9103705544237), (719.6295225977387, 1595.8507507121094), (759.6268695785355, 1595.844349080286), (799.6265847127677, 1595.8436617103032), (836.9193772512324, 1602.3792910302068), (866.5743649895799, 1627.354344081418), (895.0058157995528, 1655.2832907306743), (923.3058903322053, 1683.5294092899176), (951.5918584444937, 1711.809583923676), (941.4054245653613, 1747.626039270523),
                    (942.1021693112178, 1787.1768345838566), (938.0690334885521, 1824.4214247235893), (908.8651784454131, 1843.2132987539383), (870.126615485405, 1845.477817154334), (833.833690205973, 1831.7425380102559), (845.3356175993711, 1816.414611310261), (882.1734505510843, 1814.522031422339), (921.5996008746115, 1813.753131779298), (950.2297070175126, 1792.2983588372456), (945.2053109205384, 1755.3052552029085), (941.540567597238, 1716.8559266149991), (918.3517162332137, 1686.464572873664), (890.6145615297206, 1657.9540553661736), (862.389036473845, 1629.6454911115202), (833.876758475623, 1601.9242968472222), (797.2239195991834, 1593.8448901287231), (757.5833182881869, 1592.9773704380473), (717.6219084285742, 1592.8842212205448), (677.6260520133468, 1592.8742193994744), (637.626496927374, 1592.8731454621145), (597.6265446996539, 1592.8730301489686), (565.1591737990957, 1574.6876548188463), (536.4257456464848, 1547.4877442636514), (502.62072579503314, 1532.531739170418),
                    (468.78987664189856, 1544.0617591505322), (439.8785969567966, 1570.4711313539392), (406.054480442455, 1585.3422530379933), (366.7490600522258, 1587.014952582689), (326.82363996993666, 1587.1945573287016), (286.8316479276243, 1587.2138422414598), (246.83250777553377, 1587.2159129431998), (206.83260010100003, 1587.2161352831063), (174.3652339843039, 1605.401522105139), (145.63180634535635, 1632.6014338942684), (117.29930729758897, 1660.769272931464), (89.00985762950032, 1689.0410423655435), (63.68922198009151, 1718.5517796142806), (58.5185212278814, 1756.4098858294915), (43.80110962217777, 1796.179901735562), (46.64141469702895, 1835.4991265713693), (69.21133414591452, 1866.4579333436227), (96.88203154105834, 1895.029380656359), (125.10042079778557, 1923.3444871990348), (160.91024199028993, 1933.4467064126416), (200.46032496672532, 1934.5314239411282), (240.41201549417218, 1934.6478945988842), (280.4068283040546, 1934.6604005405345),
                    (320.1719567587059, 1934.0960579308448), (351.8026520280219, 1913.891057506269), (380.44624281879413, 1886.4742913578025), (408.76909570843935, 1858.2831677610732), (437.0575096281863, 1830.008898166451), (449.6815898179788, 1795.2388530640044), (451.0370901069097, 1755.800415195118), (451.18263584217664, 1715.860712469813), (451.19826369650264, 1675.8671868403844), (451.19994172458354, 1635.8678820206317), (451.2001219014768, 1595.8679566650421), (451.20014124782335, 1555.8679646799249), (451.2001433251215, 1515.8679655405163), (451.20014354816965, 1475.8679656329216), (450.63445814717, 1436.102280217894), (430.4293135414751, 1404.4715251454131), (403.01253191167905, 1375.827927933325), (367.288782682722, 1365.690437302664), (327.74794161300014, 1364.601932534609), (287.79724342773045, 1364.4850552251007), (249.03034554304386, 1361.5083139928172), (218.60489305811203, 1338.3933362908049), (190.0907142259065, 1310.664113711371),
                    (177.957782277709, 1278.1947279855667), (199.37444616313633, 1248.4769148897497), (233.4081614593366, 1235.6993541321033), (272.76753651730047, 1234.327373992685), (312.6987499379243, 1234.1800587469459), (352.69136403520366, 1234.1642408928797), (392.6905709799377, 1234.1625424637323), (432.0344050161348, 1235.7462792861493), (452.1379161663147, 1262.064734825855), (454.54327053005767, 1300.493480373285), (454.80154348824686, 1340.3247682110978), (454.8292753359684, 1364.9512096806222)]
noescapepath = SimplePath([Point(noescapepath[n][0], noescapepath[n][1]) for n in range(len(noescapepath))])

def distance(p1, p2):
    return pgt.cdistance(p1.x, p1.y, p2.x, p2.y)

class Status:
    def __init__(self, name, movement="walk", patrolling=False, listening=True):  # Listening determines if the teacher will hear doors
        self.name = name
        self.movement = movement
        self.patrolling = patrolling
        self.listening = listening




statuses = [Status("following main route", patrolling=True),
            Status("chasing", movement="run", listening=False),
            Status("walking to door"),
            Status("scanning", movement="stand"),
            Status("returning to route")]

class Teacher:
    def __init__(self, pathing_map, sight_map, walkspeed, runspeed):
        self.x, self.y = cenpath.points[1].x, cenpath.points[1].y
        self.dir = 0
        self.status = Teacher.get_status("following main route")
        self.path = SimplePath(cenpath.points)
        self.pathing_map = pathing_map
        self.sight_map = sight_map
        self.walkspeed = walkspeed
        self.runspeed = runspeed
        self.agro = 0
        self.scan_progress = 0
        self.fall_back_route = cenpath[:]  # Changes after final key is collected
        self.door_trigger_wait = 0  # Will only acknowldge doors every 100 frames to avoid sticky doors

    @staticmethod
    def get_status(name):
        for s in statuses:
            if s.name == name:
                return s

    def move(self):
        """
        Checks if the teacher has reached a new point in the route and then updates the steps
        If the last step is reached of a patrol route the step counter is reset
        The teacher's direction is updated based on where they are going
        X and Y coordinates are updated based on the teacher's speed and direction
        """
        if len(self.path.points) > 0:
            if distance(Point(self.x, self.y), self.path[0]) < 10:  # Reached next step
                self.path.points.pop(0)  # Removes that waypoint
        if len(self.path.points) == 0 and self.status.patrolling:
            # patrol routes are reset once the last point is reached
            if self.status.name == "following main route":
                self.path.points = cenpath[:]

        if len(self.path.points) > 0:  # It could now be 0 after the popping above
            # print("length of self.path.pooints:", len(self.path.points))
            self.dir = math.atan2(-1 * (self.y - self.path[0][1]), -1 * (self.x - self.path[0][0]))
            if self.status.movement == "run":
                speed = self.runspeed
            elif self.status.movement == "walk":
                speed = self.walkspeed
            elif self.status.movement == "stand":
                speed = 0

            self.x += speed * math.cos(self.dir)
            self.y += speed * math.sin(self.dir)


    def agro_update(self, boix, boiy, boivel):
        if self.agro > 0:
            self.agro -= .5

        toobdir = math.atan2(boiy - self.y, boix - self.x)  # Direction of a straight line from the teacher to the boy
        toobx = math.cos(toobdir) + self.x  # X value of a point one unit from the teacher, based on direction from teacher to boy
        tooby = math.sin(toobdir) + self.y
        tdpx = math.cos(self.dir) + self.x  # X value of a point one unit ahead of the teacher, based on the teacher's direction
        tdpy = math.sin(self.dir) + self.y

        if not self.sight_map.line_blocked(Point(self.x, self.y), Point(boix, boiy)):
            if yseful.cdistance(toobx, tooby, tdpx, tdpy) < 1 or (yseful.cdistance(boix, boiy, self.x, self.y) < 100 and boivel[0] > 1.6):
                self.agro += 5
                if self.agro > 50:
                    self.agro = 50

        if self.agro == 50:
            self.status = Teacher.get_status("chasing")
        elif self.agro == 0 and self.status.name == "chasing" and len(self.path) == 0:
            self.start_scan()

    def return_to_route(self):
        self.status = Teacher.get_status("returning to route")
        # Creating path back to fall back route
        # Finding cloest point to route back to
        self.closest_point = min(self.fall_back_route, key=lambda p: pgt.cdistance(p.x, p.y, self.x, self.y))
        # Creating a path to that point
        self.path = find_path(Point(self.x, self.y), self.closest_point, self.pathing_map)

    def start_scan(self):
        self.status = Teacher.get_status("scanning")  # Begin scanning the area after reaching the door
        self.scan_progress = 0  # How far until done scanning out of 100

    def update(self, boix, boiy, boivel, door):
        self.agro_update(boix, boiy, boivel)
        self.move()

        if self.status.name == "chasing" and self.agro > 0:  # If agro hits 0 the teacher should not know where the boi is
            self.path = find_path(Point(self.x, self.y), Point(boix, boiy), self.pathing_map)
            door[0] = False  # Kills the door notification so later end of chase scanning isn't interrupted by an old door

        if self.door_trigger_wait > 0:
            self.door_trigger_wait -= 1

        if self.status.listening and self.door_trigger_wait == 0:  # If the current status cares about doors
            if door[0]:  # A door was triggered
                path_to_door = find_path(Point(self.x, self.y), Point(door[1], door[2]), self.pathing_map)
                if path_to_door.points[-1].x == door[1] and path_to_door.points[-1].y == door[2]:  # If the path is complete
                    # if ihear == 0:
                    #     pygame.mixer.Sound.play(ihear_sound)
                    #     ihear = 50
                    self.path.points = path_to_door.points[:]
                    self.status = Teacher.get_status("walking to door")
                else:
                    self.door_trigger_wait = 100
                door[0] = False  # Must get reset for another potential door trigger

        if self.status.name == "walking to door":
            if len(self.path) == 0:  # Reached end of path
                self.start_scan()

        if self.status.name == "scanning":
            self.scan_progress += 1
            if self.scan_progress > 100:
                # Creating path back to fall back route
                self.return_to_route()
            else:
                self.dir = (self.scan_progress / 100) * 2 * math.pi  # Sets teacher rotation based on scan progress

        if self.status.name == "returning to route":
            if len(self.path) == 0: # Reached the end of the path
                self.path.points = self.fall_back_route[self.fall_back_route.index(self.closest_point):]
                self.status = Teacher.get_status("following main route")





